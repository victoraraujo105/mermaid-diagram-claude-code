<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{TITLE}}</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji';
            background: #f5f5f5;
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header .meta {
            font-size: 0.875rem;
            color: #ecf0f1;
            margin-top: 0.25rem;
        }

        .controls {
            background: white;
            padding: 0.75rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            z-index: 999;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: white;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .zoom-info {
            color: #7f8c8d;
            font-size: 0.875rem;
        }

        .diagram-container {
            position: fixed;
            top: 140px;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            background: white;
            cursor: grab;
        }

        .diagram-container:active {
            cursor: grabbing;
        }

        #diagram-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            padding: 2rem;
        }

        #diagram {
            max-width: none;
            transition: transform 0.1s ease-out;
        }

        .footer {
            background: #34495e;
            color: white;
            padding: 0.5rem 2rem;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            font-size: 0.75rem;
            text-align: center;
        }

        .description-panel {
            position: fixed;
            right: -400px;
            top: 140px;
            bottom: 0;
            width: 400px;
            background: white;
            box-shadow: -2px 0 4px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 998;
            overflow-y: auto;
            padding: 2rem;
        }

        .description-panel.open {
            right: 0;
        }

        .description-panel h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .description-panel p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 1rem;
        }

        .description-panel .related-files {
            margin-top: 1.5rem;
        }

        .description-panel .related-files h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .description-panel .related-files ul {
            list-style: none;
        }

        .description-panel .related-files li {
            padding: 0.25rem 0;
            color: #3498db;
            font-family: monospace;
            font-size: 0.875rem;
        }

        /* Keyboard shortcuts hint */
        .shortcuts {
            position: fixed;
            bottom: 30px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .shortcuts.show {
            opacity: 1;
        }

        .shortcuts kbd {
            background: #555;
            padding: 0.125rem 0.375rem;
            border-radius: 2px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{TITLE}}</h1>
        <div class="meta">
            Generated: {{GENERATED}} | Type: {{TYPE}} | Context: {{CONTEXT}}
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="zoomIn()">Zoom In (+)</button>
        <button class="btn" onclick="zoomOut()">Zoom Out (-)</button>
        <button class="btn btn-secondary" onclick="resetView()">Reset View (R)</button>
        <button class="btn btn-secondary" onclick="fitToScreen()">Fit to Screen (F)</button>
        <button class="btn btn-secondary" onclick="toggleDescription()">Toggle Info (I)</button>
        <span class="zoom-info">Zoom: <span id="zoom-level">100</span>%</span>
    </div>

    <div class="diagram-container" id="container">
        <div id="diagram-wrapper">
            <div id="diagram" class="mermaid">
{{MERMAID_CODE}}
            </div>
        </div>
    </div>

    <div class="description-panel" id="description-panel">
        <h2>Description</h2>
        <p>{{DESCRIPTION}}</p>

        <div class="related-files">
            <h3>Related Files</h3>
            <ul>
{{RELATED_FILES}}
            </ul>
        </div>
    </div>

    <div class="footer">
        Use mouse wheel to zoom | Drag to pan | Press ? for keyboard shortcuts
    </div>

    <div class="shortcuts" id="shortcuts">
        <strong>Keyboard Shortcuts:</strong><br>
        <kbd>+</kbd> / <kbd>=</kbd> Zoom In<br>
        <kbd>-</kbd> Zoom Out<br>
        <kbd>R</kbd> Reset View<br>
        <kbd>F</kbd> Fit to Screen<br>
        <kbd>I</kbd> Toggle Info Panel<br>
        <kbd>?</kbd> Show/Hide Shortcuts
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji"',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true
            }
        });

        // Pan and Zoom functionality
        let currentZoom = 1;
        let panzoomInstance;

        // Wait for Mermaid to render
        setTimeout(() => {
            const elem = document.getElementById('diagram-wrapper');
            const container = document.getElementById('container');

            panzoomInstance = Panzoom(elem, {
                maxScale: 5,
                minScale: 0.05,
                step: 0.1,
                canvas: true,
                contain: 'outside'
            });

            // Mouse wheel zoom
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                panzoomInstance.zoomWithWheel(e);
                updateZoomLevel();
            });

            // Update zoom level display
            elem.addEventListener('panzoomchange', updateZoomLevel);
        }, 500);

        function updateZoomLevel() {
            const scale = panzoomInstance.getScale();
            currentZoom = scale;
            document.getElementById('zoom-level').textContent = Math.round(scale * 100);
        }

        function zoomIn() {
            panzoomInstance.zoomIn();
            updateZoomLevel();
        }

        function zoomOut() {
            panzoomInstance.zoomOut();
            updateZoomLevel();
        }

        function resetView() {
            panzoomInstance.reset();
            updateZoomLevel();
        }

        function fitToScreen() {
            const diagram = document.querySelector('#diagram svg');
            const container = document.getElementById('container');

            if (diagram && container) {
                const diagramRect = diagram.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();

                const scaleX = (containerRect.width * 0.9) / diagramRect.width;
                const scaleY = (containerRect.height * 0.9) / diagramRect.height;
                const scale = Math.min(scaleX, scaleY, 1);

                panzoomInstance.zoom(scale);
                panzoomInstance.pan(0, 0);
                updateZoomLevel();
            }
        }

        function toggleDescription() {
            const panel = document.getElementById('description-panel');
            panel.classList.toggle('open');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case '+':
                case '=':
                    e.preventDefault();
                    zoomIn();
                    break;
                case '-':
                    e.preventDefault();
                    zoomOut();
                    break;
                case 'r':
                case 'R':
                    e.preventDefault();
                    resetView();
                    break;
                case 'f':
                case 'F':
                    e.preventDefault();
                    fitToScreen();
                    break;
                case 'i':
                case 'I':
                    e.preventDefault();
                    toggleDescription();
                    break;
                case '?':
                    e.preventDefault();
                    toggleShortcuts();
                    break;
            }
        });

        function toggleShortcuts() {
            const shortcuts = document.getElementById('shortcuts');
            shortcuts.classList.toggle('show');
        }

        // Auto fit on load
        window.addEventListener('load', () => {
            setTimeout(fitToScreen, 1000);
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (currentZoom === 1) {
                fitToScreen();
            }
        });
    </script>
</body>
</html>
